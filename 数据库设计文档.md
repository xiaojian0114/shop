# 数据库设计文档

## 📋 数据库概述

- **数据库类型**: MySQL
- **字符集**: UTF-8
- **排序规则**: utf8mb4_general_ci
- **表数量**: 6张

---

## 📊 数据表清单

1. **user** - 用户表
2. **shop** - 店铺表
3. **product** - 商品表
4. **order** - 订单表
5. **order_item** - 订单项表
6. **cart** - 购物车表

---

## 1. 用户表 (user)

### 表结构

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键，自增 |
| phone | VARCHAR | 255 | NULL | - | 手机号（登录账号） |
| password | VARCHAR | 255 | NULL | - | 密码（BCrypt加密） |
| nickname | VARCHAR | 255 | NULL | - | 昵称 |
| avatar | VARCHAR | 255 | NULL | - | 头像URL |
| role | VARCHAR | 50 | NULL | - | 角色：user/merchant/admin |
| status | INT | - | NULL | 1 | 状态：1正常，0禁用 |
| create_time | DATETIME | - | NULL | - | 创建时间 |

### 索引

- **主键**: `PRIMARY KEY (id)`
- **唯一索引**: `UNIQUE KEY uk_phone (phone)` (建议添加)

### 字段说明

- **id**: 用户唯一标识
- **phone**: 手机号，用于登录，建议唯一
- **password**: 密码，使用BCrypt加密存储
- **nickname**: 用户昵称，注册时自动生成（如：用户8000）
- **avatar**: 头像图片URL
- **role**: 用户角色
  - `user`: 普通用户
  - `merchant`: 商家
  - `admin`: 管理员
- **status**: 用户状态
  - `1`: 正常/启用
  - `0`: 禁用
- **create_time**: 注册时间

### 建表SQL

```sql
CREATE TABLE `user` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '用户ID',
  `phone` VARCHAR(255) DEFAULT NULL COMMENT '手机号',
  `password` VARCHAR(255) DEFAULT NULL COMMENT '密码（加密）',
  `nickname` VARCHAR(255) DEFAULT NULL COMMENT '昵称',
  `avatar` VARCHAR(255) DEFAULT NULL COMMENT '头像URL',
  `role` VARCHAR(50) DEFAULT NULL COMMENT '角色：user/merchant/admin',
  `status` INT DEFAULT 1 COMMENT '状态：1正常，0禁用',
  `create_time` DATETIME DEFAULT NULL COMMENT '创建时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_phone` (`phone`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';
```

---

## 2. 店铺表 (shop)

### 表结构

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键，自增 |
| merchant_id | BIGINT | - | NULL | - | 商家ID（关联user.id） |
| name | VARCHAR | 255 | NULL | - | 店铺名称 |
| logo | VARCHAR | 255 | NULL | - | 店铺Logo URL |
| status | INT | - | NULL | 0 | 状态：0审核中，1通过，2驳回 |
| create_time | DATETIME | - | NULL | - | 创建时间 |

### 索引

- **主键**: `PRIMARY KEY (id)`
- **普通索引**: `KEY idx_merchant_id (merchant_id)` (建议添加)

### 字段说明

- **id**: 店铺唯一标识
- **merchant_id**: 商家用户ID，外键关联user表
- **name**: 店铺名称
- **logo**: 店铺Logo图片URL
- **status**: 店铺审核状态
  - `0`: 审核中
  - `1`: 审核通过
  - `2`: 审核驳回
- **create_time**: 申请时间

### 建表SQL

```sql
CREATE TABLE `shop` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '店铺ID',
  `merchant_id` BIGINT DEFAULT NULL COMMENT '商家ID',
  `name` VARCHAR(255) DEFAULT NULL COMMENT '店铺名称',
  `logo` VARCHAR(255) DEFAULT NULL COMMENT '店铺Logo URL',
  `status` INT DEFAULT 0 COMMENT '状态：0审核中，1通过，2驳回',
  `create_time` DATETIME DEFAULT NULL COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_merchant_id` (`merchant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='店铺表';
```

---

## 3. 商品表 (product)

### 表结构

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键，自增 |
| shop_id | BIGINT | - | NULL | - | 店铺ID（关联shop.id） |
| name | VARCHAR | 255 | NULL | - | 商品名称 |
| image | VARCHAR | 255 | NULL | - | 商品图片URL |
| price | DECIMAL | 10,2 | NULL | - | 商品价格 |
| stock | INT | - | NULL | - | 库存数量 |
| sales | INT | - | NULL | 0 | 销量 |
| is_on_sale | INT | - | NULL | 1 | 是否上架：1上架，0下架 |
| create_time | DATETIME | - | NULL | - | 创建时间 |

### 索引

- **主键**: `PRIMARY KEY (id)`
- **普通索引**: `KEY idx_shop_id (shop_id)` (建议添加)
- **普通索引**: `KEY idx_is_on_sale (is_on_sale)` (建议添加)

### 字段说明

- **id**: 商品唯一标识
- **shop_id**: 所属店铺ID，外键关联shop表
- **name**: 商品名称
- **image**: 商品图片URL
- **price**: 商品价格，使用DECIMAL类型保证精度
- **stock**: 库存数量
- **sales**: 销量，默认0
- **is_on_sale**: 上架状态
  - `1`: 上架
  - `0`: 下架
- **create_time**: 创建时间

### 建表SQL

```sql
CREATE TABLE `product` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '商品ID',
  `shop_id` BIGINT DEFAULT NULL COMMENT '店铺ID',
  `name` VARCHAR(255) DEFAULT NULL COMMENT '商品名称',
  `image` VARCHAR(255) DEFAULT NULL COMMENT '商品图片URL',
  `price` DECIMAL(10,2) DEFAULT NULL COMMENT '商品价格',
  `stock` INT DEFAULT NULL COMMENT '库存数量',
  `sales` INT DEFAULT 0 COMMENT '销量',
  `is_on_sale` INT DEFAULT 1 COMMENT '是否上架：1上架，0下架',
  `create_time` DATETIME DEFAULT NULL COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_shop_id` (`shop_id`),
  KEY `idx_is_on_sale` (`is_on_sale`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品表';
```

---

## 4. 订单表 (order)

### 表结构

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键，自增 |
| order_no | VARCHAR | 255 | NULL | - | 订单号（唯一） |
| user_id | BIGINT | - | NULL | - | 用户ID（关联user.id） |
| shop_id | BIGINT | - | NULL | - | 店铺ID（关联shop.id） |
| total_amount | DECIMAL | 10,2 | NULL | - | 订单总金额 |
| status | INT | - | NULL | 1 | 订单状态：1待支付，2待发货，3待收货，4已完成，5已取消 |
| address | VARCHAR | 500 | NULL | - | 收货地址 |
| pay_time | DATETIME | - | NULL | - | 支付时间 |
| deliver_time | DATETIME | - | NULL | - | 发货时间 |
| create_time | DATETIME | - | NULL | - | 创建时间 |

### 索引

- **主键**: `PRIMARY KEY (id)`
- **唯一索引**: `UNIQUE KEY uk_order_no (order_no)` (建议添加)
- **普通索引**: `KEY idx_user_id (user_id)` (建议添加)
- **普通索引**: `KEY idx_shop_id (shop_id)` (建议添加)
- **普通索引**: `KEY idx_status (status)` (建议添加)

### 字段说明

- **id**: 订单唯一标识
- **order_no**: 订单号，格式：ORD + 12位随机字符，唯一
- **user_id**: 下单用户ID，外键关联user表
- **shop_id**: 店铺ID，外键关联shop表
- **total_amount**: 订单总金额，使用DECIMAL类型保证精度
- **status**: 订单状态
  - `1`: 待支付
  - `2`: 待发货（已支付）
  - `3`: 待收货（已发货）
  - `4`: 已完成
  - `5`: 已取消
- **address**: 收货地址
- **pay_time**: 支付时间
- **deliver_time**: 发货时间
- **create_time**: 订单创建时间

### 建表SQL

```sql
CREATE TABLE `order` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '订单ID',
  `order_no` VARCHAR(255) DEFAULT NULL COMMENT '订单号',
  `user_id` BIGINT DEFAULT NULL COMMENT '用户ID',
  `shop_id` BIGINT DEFAULT NULL COMMENT '店铺ID',
  `total_amount` DECIMAL(10,2) DEFAULT NULL COMMENT '订单总金额',
  `status` INT DEFAULT 1 COMMENT '订单状态：1待支付，2待发货，3待收货，4已完成，5已取消',
  `address` VARCHAR(500) DEFAULT NULL COMMENT '收货地址',
  `pay_time` DATETIME DEFAULT NULL COMMENT '支付时间',
  `deliver_time` DATETIME DEFAULT NULL COMMENT '发货时间',
  `create_time` DATETIME DEFAULT NULL COMMENT '创建时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_order_no` (`order_no`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_shop_id` (`shop_id`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单表';
```

---

## 5. 订单项表 (order_item)

### 表结构

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键，自增 |
| order_id | BIGINT | - | NULL | - | 订单ID（关联order.id） |
| product_id | BIGINT | - | NULL | - | 商品ID（关联product.id） |
| product_name | VARCHAR | 255 | NULL | - | 商品名称（快照） |
| product_image | VARCHAR | 255 | NULL | - | 商品图片（快照） |
| price | DECIMAL | 10,2 | NULL | - | 单价（快照） |
| num | INT | - | NULL | - | 购买数量 |

### 索引

- **主键**: `PRIMARY KEY (id)`
- **普通索引**: `KEY idx_order_id (order_id)` (建议添加)
- **普通索引**: `KEY idx_product_id (product_id)` (建议添加)

### 字段说明

- **id**: 订单项唯一标识
- **order_id**: 所属订单ID，外键关联order表
- **product_id**: 商品ID，外键关联product表
- **product_name**: 商品名称快照（下单时的商品名称）
- **product_image**: 商品图片快照（下单时的商品图片）
- **price**: 单价快照（下单时的商品价格）
- **num**: 购买数量

**注意**: 订单项中的商品信息是快照数据，即使商品信息后续修改，订单项中的信息保持不变。

### 建表SQL

```sql
CREATE TABLE `order_item` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '订单项ID',
  `order_id` BIGINT DEFAULT NULL COMMENT '订单ID',
  `product_id` BIGINT DEFAULT NULL COMMENT '商品ID',
  `product_name` VARCHAR(255) DEFAULT NULL COMMENT '商品名称（快照）',
  `product_image` VARCHAR(255) DEFAULT NULL COMMENT '商品图片（快照）',
  `price` DECIMAL(10,2) DEFAULT NULL COMMENT '单价（快照）',
  `num` INT DEFAULT NULL COMMENT '购买数量',
  PRIMARY KEY (`id`),
  KEY `idx_order_id` (`order_id`),
  KEY `idx_product_id` (`product_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单项表';
```

---

## 6. 购物车表 (cart)

### 表结构

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键，自增 |
| user_id | BIGINT | - | NULL | - | 用户ID（关联user.id） |
| product_id | BIGINT | - | NULL | - | 商品ID（关联product.id） |
| num | INT | - | NULL | 1 | 商品数量 |
| create_time | DATETIME | - | NULL | - | 创建时间 |

### 索引

- **主键**: `PRIMARY KEY (id)`
- **普通索引**: `KEY idx_user_id (user_id)` (建议添加)
- **唯一索引**: `UNIQUE KEY uk_user_product (user_id, product_id)` (建议添加，防止重复添加)

### 字段说明

- **id**: 购物车项唯一标识
- **user_id**: 用户ID，外键关联user表
- **product_id**: 商品ID，外键关联product表
- **num**: 商品数量，默认1
- **create_time**: 加入购物车时间

### 建表SQL

```sql
CREATE TABLE `cart` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '购物车ID',
  `user_id` BIGINT DEFAULT NULL COMMENT '用户ID',
  `product_id` BIGINT DEFAULT NULL COMMENT '商品ID',
  `num` INT DEFAULT 1 COMMENT '商品数量',
  `create_time` DATETIME DEFAULT NULL COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  UNIQUE KEY `uk_user_product` (`user_id`, `product_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='购物车表';
```

---

## 🔗 表关系图

```
user (用户表)
  ├── 1:N → shop (店铺表) [merchant_id]
  ├── 1:N → order (订单表) [user_id]
  └── 1:N → cart (购物车表) [user_id]

shop (店铺表)
  ├── 1:N → product (商品表) [shop_id]
  └── 1:N → order (订单表) [shop_id]

order (订单表)
  └── 1:N → order_item (订单项表) [order_id]

product (商品表)
  ├── 1:N → order_item (订单项表) [product_id]
  └── 1:N → cart (购物车表) [product_id]
```

---

## 📝 状态码说明

### 用户状态 (user.status)
- `1`: 正常/启用
- `0`: 禁用

### 店铺状态 (shop.status)
- `0`: 审核中
- `1`: 审核通过
- `2`: 审核驳回

### 商品上架状态 (product.is_on_sale)
- `1`: 上架
- `0`: 下架

### 订单状态 (order.status)
- `1`: 待支付
- `2`: 待发货（已支付）
- `3`: 待收货（已发货）
- `4`: 已完成
- `5`: 已取消

---

## 🔑 外键关系（建议）

虽然代码中使用MyBatis-Plus，没有在数据库层面设置外键约束，但建议在应用层面保证数据一致性：

1. **shop.merchant_id** → **user.id**
2. **product.shop_id** → **shop.id**
3. **order.user_id** → **user.id**
4. **order.shop_id** → **shop.id**
5. **order_item.order_id** → **order.id**
6. **order_item.product_id** → **product.id**
7. **cart.user_id** → **user.id**
8. **cart.product_id** → **product.id**

---

## 📊 数据字典

### 角色类型 (user.role)
- `user`: 普通用户
- `merchant`: 商家
- `admin`: 管理员

---

## ⚠️ 注意事项

1. **订单号唯一性**: order_no字段必须唯一，建议添加唯一索引
2. **价格精度**: 所有价格相关字段使用DECIMAL(10,2)保证精度
3. **订单项快照**: order_item表中的商品信息是快照，下单后不会随商品信息变化
4. **购物车去重**: 同一用户同一商品在购物车中只存在一条记录，通过唯一索引保证
5. **时间字段**: 所有时间字段使用DATETIME类型，存储格式：YYYY-MM-DD HH:MM:SS
6. **字符集**: 建议使用utf8mb4字符集，支持emoji等特殊字符

---

**文档版本**: v1.0  
**最后更新**: 2024年

